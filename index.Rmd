---
title: 'Project 1: Wrangling, Exploration, Visualization'
author: "SDS322E"
date: ''
output:
  html_document:
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: yes
  pdf_document:
    toc: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, fig.align = "center", warning = F, message = F,
tidy=TRUE, tidy.opts=list(width.cutoff=60), R.options=list(max.print=100))
```

## Data Wrangling, Exploration, Visualization

### Sara Blanco, seb4296

### Introduction 

Paragraph or two introducing your datasets and variables, why they are interesting to you, etc.

```{R}
library(tidyverse)
DeathRate <- read_csv("~/DeathRate.csv")
HealthIns <- read_csv("~/healthins.csv")


head(DeathRate)
head(HealthIns)

```

### Tidying: Reshaping

If your datasets are tidy already, demonstrate that you can reshape data with pivot wider/longer here (e.g., untidy and then retidy). Alternatively, it may be easier to wait until the wrangling section so you can reshape your summary statistics. Note here if you are going to do this.

```{R}

usdeath <- DeathRate %>% pivot_longer(2:73, names_to="CancerType", values_to="DeathRate") 
usdeath <- usdeath %>% na_if("n/a") %>% na_if("Not available - Rate not displayed due to fewer than 10 deaths.")
usdeath <- usdeath %>% mutate(DeathRate = str_remove_all(DeathRate, "[- Female breast cancer only.]")) %>% mutate(State = str_replace_all(State, "All U.S. combined", "United States"))

usdeath <- usdeath %>% mutate(DeathRate = as.numeric(DeathRate))
usdeath %>% str()



healthinsurance <- HealthIns %>% rename("2010" = "Uninsured Rate (2010)") %>% rename("2015" = "Uninsured Rate (2015)")  %>% rename("2013" = "Medicaid Enrollment (2013)") %>% rename("2016" = "Medicaid Enrollment (2016)") %>% rename("MedicaidExpansion" = "State Medicaid Expansion (2016)") %>% pivot_longer(cols=c("2010":"2015"), names_to="UninsuredYear", values_to="UninsuredRateperc") %>% mutate(UninsuredRateperc = str_remove_all(UninsuredRateperc, "[-%]")) %>% pivot_longer(cols=c("2013":"2016"), names_to="MedicaidYear", values_to="MedicaidEnrollment") %>% select(-"Marketplace Tax Credits (2016)", -"Average Monthly Tax Credit (2016)", -"Employer Health Insurance Coverage (2015)", - "Marketplace Health Insurance Coverage (2016)", -"Health Insurance Coverage Change (2010-2015)", -"Medicare Enrollment (2016)", -"Uninsured Rate Change (2010-2015)", -"Medicaid Enrollment Change (2013-2016)")

healthinsurance <- healthinsurance %>% mutate(UninsuredRateperc = as.numeric(UninsuredRateperc))
healthinsurance %>% str()


#Uninsured Year = uninsured rate before (2010) and after (2015) ACA
#Medicaid Year = medicaid enrollment before (2013) and after (2016) ACA
healthinsurance

#May use pivot_wider when reshaping summary statistics!
#healthinsurance %>% pivot_wider()

```

    
### Joining/Merging

```{R}
fulldata <- left_join(healthinsurance, usdeath, by="State")
glimpse(fulldata)
fulldata
```
Discussions of joining here. Feel encouraged to break up into more than once code chunk and discuss each in turn.

```{R}
healthinsurance %>% dim()
usdeath %>% dim()
fulldata %>% dim()
#Disucss the size of joined dataset and how it relates to size of original datasets
#In the joined dataset, note how many observations/rows were dropped, and any potential problems with this

```
Discussions of joining here. Feel encouraged to break up into more than once code chunk and discuss each in turn.

```{R}
#healthinsurance %>% distinct(State) 
healthinsurance %>% summarize_all(n_distinct)
#usdeath %>% distinct(State) 
usdeath %>% summarize_all(n_distinct)
fulldata %>% summarize_all(n_distinct)

```
Discussions of joining here. Feel encouraged to break up into more than once code chunk and discuss each in turn.

```{R}
anti_join(healthinsurance, usdeath, by="State") %>% distinct(State)
#who in insurance does not have a match in death
anti_join(usdeath, healthinsurance, by="State") %>% distinct(State)
semi_join(healthinsurance, usdeath, by="State") %>% distinct(State)
#who in insurance is in death
semi_join(usdeath, healthinsurance, by="State") %>% distinct(State)
```
Discussions of joining here. Feel encouraged to break up into more than once code chunk and discuss each in turn.



###  Wrangling

```{R}
fulldata %>% summarize_all(n_distinct)


fulldata %>% group_by(MedicaidExpansion) %>% filter(MedicaidExpansion == TRUE) %>% distinct(State) %>% summarize(n=n())
#fulldata %>% group_by(MedicaidExpansion)  %>% distinct(State) %>% summarize(sum(MedicaidExpansion))

fulldata %>% group_by(State) %>% summarize(Uninsuredsd = sd(UninsuredRateperc)) %>% arrange(desc(Uninsuredsd))

fulldata %>% group_by(State) %>% filter(MedicaidExpansion == TRUE, MedicaidYear == 2013) %>% select(MedicaidEnrollment) %>% distinct(MedicaidEnrollment)

fulldata %>% group_by(State, CancerType) %>% filter(MedicaidExpansion == TRUE) %>% filter(!CancerType == "All cancer types combined / Male", !CancerType == "All cancer types combined / Both sexes combined", !CancerType == "All cancer types combined / Female") %>% arrange(desc(DeathRate)) %>% distinct(DeathRate)


fulldata %>% na.omit() %>% filter(MedicaidEnrollment == max(MedicaidEnrollment)) %>% filter(!CancerType == "All cancer types combined / Male", !CancerType == "All cancer types combined / Both sexes combined", !CancerType == "All cancer types combined / Female") %>% filter(!State == "United States") %>% arrange(desc(MedicaidEnrollment)) %>% distinct(MedicaidEnrollment) %>% filter(MedicaidEnrollment==max(MedicaidEnrollment))

nfulldata <- fulldata %>% pivot_wider(names_from="UninsuredYear", values_from="UninsuredRateperc") %>% rename("col1"="2010", "col2"="2015") 

b <- nfulldata %>% select("col2")
nfulldata %>% filter(!CancerType == "All cancer types combined / Male", !CancerType == "All cancer types combined / Both sexes combined", !CancerType == "All cancer types combined / Female") %>% summarize(n_distinct(CancerType))
changeinunins <- function(x) (x/69)
nfulldata %>% group_by(State, col1, col2) %>% mutate(UninsuredChange = col1-col2) %>% summarize(PercentageDueToType = changeinunins(UninsuredChange)) %>% distinct(PercentageDueToType)


fulldata %>% distinct(CancerType) %>% filter(str_detect(CancerType, "Male"))

#need to use 1 more functions within summarize  
#mean, standard deviation, count, and standard error of `distance` in each month (i.e., averaged across `day`) for flights from the three different New York airports (`origin`). You will use your sd and count to find your se=sd/sqrt(count). Rename your summary variables inside of `summarize()`. 


```
Your discussion of wrangling section here. Feel encouraged to break up into more than once code chunk and discuss each in turn.

```{R}

```
Your discussion of wrangling section here. Feel encouraged to break up into more than once code chunk and discuss each in turn.

```{R}

```
Your discussion of wrangling section here. Feel encouraged to break up into more than once code chunk and discuss each in turn.

### Visualizing

```{R}
#ggplot(fulldata, aes(x= , y=DeathRate, color= State)) + geom_point(size= , alpha =)
  
fulldata %>% group_by(State, CancerType) %>% filter(!CancerType == "All cancer types combined") %>% filter(!State == "United States") %>% distinct(CancerType) 




fulldata %>% group_by(State, UninsuredRateperc, UninsuredYear, CancerType, DeathRate, MedicaidExpansion) %>% filter(!State == "United States") %>% distinct(UninsuredRateperc) %>% arrange(desc(UninsuredRateperc)) %>% filter(CancerType == "All cancer types combined / Both sexes combined") %>% filter(MedicaidExpansion == FALSE) %>% ggplot(aes(y=UninsuredRateperc, x=DeathRate, color=State)) + geom_point(aes(shape=UninsuredYear), alpha=0.80) + geom_line() + ggtitle("Change in Uninsured and Death Rates of Non-Expanding States") + xlab("Death Rate for All cancer types combined / Both sexes combined") + ylab("Uninsured Rate") + theme(plot.title = element_text(hjust = 0.5)) + scale_y_continuous(breaks=seq(0,25,10)) + theme(legend.title = element_text( size=10), legend.text=element_text(size=8))
  
```

Your discussion of plot 1

```{R}
fulldata %>% group_by(State, MedicaidExpansion, CancerType, DeathRate) %>% filter(!CancerType == "All cancer types combined") %>% filter(!State == "United States") %>% distinct(CancerType) %>% filter(CancerType == "Lung and bronchus / Both sexes combined") %>% ggplot(aes(y=State, fill=MedicaidExpansion)) + geom_bar(aes(x=DeathRate), stat = "summary") + ggtitle("Lung and Bronchus Death by State") + theme(plot.title = element_text(hjust = 0.5)) + scale_x_continuous(breaks=seq(0,800,100)) + scale_fill_brewer(palette="Set1") + xlab("Death Rate for Lung and bronchus / Both sexes combined") + theme(plot.title = element_text(hjust = 0.5)) + theme(legend.title = element_text( size=10), legend.text=element_text(size=8))


#fulldata %>% group_by(State, MedicaidExpansion, CancerType, DeathRate) %>% mutate(CancerType = str_remove_all(CancerType, " / Male")) %>% mutate(CancerType = str_remove_all(CancerType, " / Female")) %>% mutate(CancerType = str_remove_all(CancerType, " / Male")) %>% mutate(CancerType = str_remove_all(CancerType, " / Both sexes combined")) %>% filter(!CancerType == "All cancer types combined") %>% filter(!State == "United States") %>% distinct(CancerType) %>% filter(CancerType == "Lung and bronchus") 

#%>% mutate(CancerType = str_remove_all(CancerType, " / Male")) %>% mutate(CancerType = str_remove_all(CancerType, " / Female")) %>% mutate(CancerType = str_remove_all(CancerType, " / Male")) %>% mutate(CancerType = str_remove_all(CancerType, " / Both sexes combined"))%>%
```

Your discussion of plot 2

```{R}
#fulldata %>% na.omit() %>% group_by(UninsuredRateperc, UninsuredYear, State, DeathRate) %>% filter(CancerType == "All cancer types combined / Both sexes combined") %>% ggplot(aes(x=DeathRate)) + geom_density(alpha =0.25) + facet_grid(~MedicaidExpansion)
  
fulldata %>% na.omit() %>% filter(!CancerType == "All cancer types combined / Male", !CancerType == "All cancer types combined / Both sexes combined", !CancerType == "All cancer types combined / Female") %>% filter(!State == "United States") %>% arrange(desc(MedicaidEnrollment)) %>% ggplot(aes(x=MedicaidEnrollment, y=DeathRate, color=State)) + geom_point(alpha =0.25) + facet_grid(~MedicaidYear) + theme(legend.title = element_text( size=10), legend.text=element_text(size=8)) + scale_x_log10() + ggtitle("Medicaid Enrollment and Death Rate by State Before and After ACA") + xlab("Medicaid Enrollment") + ylab("Death Rate") + theme(plot.title = element_text(hjust = 0.5)) + theme(legend.title = element_text( size=10), legend.text=element_text(size=8))


```

Your discussion of plot 3

### Concluding Remarks

If any!




